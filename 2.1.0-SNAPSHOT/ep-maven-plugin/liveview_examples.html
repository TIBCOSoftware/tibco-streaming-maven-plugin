<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/markdown/liveview_examples.md at 2021-10-26
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Event Processing Maven Plugin &#x2013; LiveView fragment examples</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>Event Processing Maven Plugin</h2>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2021-10-26<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.1.0-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://devzone.tibco.com/display/comp/TIBCO+Component+Exchange" class="externalLink" title="Component Exchange">Component Exchange</a></li>
      <li class="pull-right"><a href="https://devzone.tibco.com/dashboard.action" class="externalLink" title="DevZone">DevZone</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="usage.html" title="Usage"><span class="icon-chevron-down"></span>Usage</a>
     <ul class="nav nav-list">
      <li><a href="general_examples.html" title="General examples"><span class="none"></span>General examples</a></li>
      <li><a href="java_examples.html" title="Java fragment examples"><span class="none"></span>Java fragment examples</a></li>
      <li><a href="java_jar_examples.html" title="Java jar examples"><span class="none"></span>Java jar examples</a></li>
      <li><a href="eventflow_examples.html" title="EventFlow fragment examples"><span class="none"></span>EventFlow fragment examples</a></li>
      <li><a href="tcs_examples.html" title="TIBCO Cloud Streaming fragment examples"><span class="none"></span>TIBCO Cloud Streaming fragment examples</a></li>
      <li class="active"><a href="#"><span class="none"></span>LiveView fragment examples</a></li>
      <li><a href="application_examples.html" title="Application examples"><span class="none"></span>Application examples</a></li>
      <li><a href="contint_examples.html" title="CI examples"><span class="none"></span>CI examples</a></li>
      <li><a href="cloud_examples.html" title="Cloud examples"><span class="none"></span>Cloud examples</a></li>
     </ul></li>
    <li><a href="goals.html" title="Goals"><span class="icon-chevron-right"></span>Goals</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://www.tibco.com/" title="Tibco" class="builtBy"><img class="builtBy"  alt="Tibco" src="images/Tibco.svg"    /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>LiveView fragment examples</h1>
<ul>

<li><a href="#directory-structure">Directory structure</a></li>
<li><a href="#basic-build">Basic build</a></li>
<li><a href="#launch-liveview-fragment">Launch liveview fragment</a></li>
</ul>
<p><a name="directory-structure"></a></p><section>
<h2><a name="Directory_structure"></a>Directory structure</h2>
<p>The recommended LiveView directory structure is :</p>
<p><img src="uml/liveview-structure.svg" alt="LiveView directory structure" /></p>
<p>Note that the default source directory is set by the plugin to src/main/liveview.</p>
<p><a name="basic-build"></a></p></section><section>
<h2><a name="Basic_build"></a>Basic build</h2>
<p>The following pom.xml will build, unit test and install to the local maven repository, a LiveView fragment.</p>

<div>
<div>
<pre class="source">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;

    &lt;!-- vim: set tabstop=4 softtabstop=0 expandtab shiftwidth=4 smarttab : --&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
    &lt;artifactId&gt;lvfrag&lt;/artifactId&gt;
    &lt;packaging&gt;ep-liveview-fragment&lt;/packaging&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;name&gt;hello world&lt;/name&gt;

    &lt;!-- common definitions for this version of StreamBase --&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.tibco.ep.sb.parent&lt;/groupId&gt;
        &lt;artifactId&gt;ep-liveview-fragment&lt;/artifactId&gt;
        &lt;version&gt;10.4.0}&lt;/version&gt;
    &lt;/parent&gt;

&lt;/project&gt;
</pre></div></div>

<p>When the maven install goal is called (mvn install), this pom.xml instructs maven to perform the following steps :</p>
<ol style="list-style-type: decimal">

<li>

<p>Uses <a class="externalLink" href="https://tibcosoftware.github.io/tibco-streaming-maven-plugin/2.1.0-SNAPSHOT/ep-maven-plugin/install-product-mojo.html">install-product</a> to check if the dependent product ( in this com.tibco.ep.thirdparty:tibco-sb_linuxx86_64 ) is installed.  If its not, maven will download the archive and the plugin will extract into $TIBCO_EP_HOME.</p>
</li>
<li>

<p>Uses the standard maven plugin <a class="externalLink" href="https://maven.apache.org/plugins/maven-compiler-plugin/testCompile-mojo.html">maven-compiler-plugin:testCompile</a> to compile any java test sources to class files.</p>
</li>
<li>

<p>Uses <a class="externalLink" href="https://tibcosoftware.github.io/tibco-streaming-maven-plugin/2.1.0-SNAPSHOT/ep-maven-plugin/start-nodes-mojo.html">start-nodes</a> to start a test cluster.<br />
Since this pom.xml has no configuration, a single node is started A.${artifactId} (ie A.goldylocks in this example) with a random but unused discovery port.</p>
</li>
<li>

<p>Uses <a class="externalLink" href="https://tibcosoftware.github.io/tibco-streaming-maven-plugin/2.1.0-SNAPSHOT/ep-maven-plugin/test-liveview-fragment-mojo.html">test-liveview-fragment</a> to launch sbunit on the cluster and report the test results.  Should the test cases fail then no further processing occurs.</p>
</li>
<li>

<p>Uses <a class="externalLink" href="https://tibcosoftware.github.io/tibco-streaming-maven-plugin/2.1.0-SNAPSHOT/ep-maven-plugin/stop-nodes-mojo.html">stop-nodes</a> to stop and remove the test nodes</p>
</li>
<li>

<p>Uses <a class="externalLink" href="https://tibcosoftware.github.io/tibco-streaming-maven-plugin/2.1.0-SNAPSHOT/ep-maven-plugin/package-liveview-fragment-mojo.html">package-liveview-fragment</a> to create a LiveView fragment zip file in the build directory (by default, set to target) and attaches it to the build.  Note that the fragment zip will include any LiveView Web plugins, themes and wars.</p>
</li>
<li>

<p>Uses the standard maven plugin <a class="externalLink" href="https://maven.apache.org/plugins/maven-install-plugin/install-mojo.html">maven-install-plugin:install</a> to install the built and tested artifacts to the local maven repository.</p>
</li>
</ol>
<p><a name="launch-liveview-fragment"></a></p></section><section>
<h2><a name="Launch_liveview_fragment"></a>Launch liveview fragment</h2>
<p>Whilst launching of liveview is usually done when an application archive is deployed, its possible to start the fragment using <a class="externalLink" href="https://tibcosoftware.github.io/tibco-streaming-maven-plugin/2.1.0-SNAPSHOT/ep-maven-plugin/deploy-fragment-mojo.html">deploy-fragment</a>. For example a test case might want to start liveview and use playback to inject test data.</p>
<p>One challenge, though, is waiting for liveview to be completely started up - the <a class="externalLink" href="http://maven.apache.org/plugins/maven-antrun-plugin/">maven-antrun-plugin</a> can be used to monitor the log file.</p>

<div>
<div>
<pre class="source">...
    &lt;!-- common definitions for this version of StreamBase --&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.tibco.ep.sb.parent&lt;/groupId&gt;
        &lt;artifactId&gt;ep-liveview-fragment&lt;/artifactId&gt;
        &lt;version&gt;10.4.0&lt;/version&gt;
    &lt;/parent&gt;
...
    &lt;build&gt;

        &lt;plugins&gt;

            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;executions&gt;

                    &lt;!-- start nodes --&gt;
                    &lt;execution&gt;
                        &lt;id&gt;start nodes&lt;/id&gt;
                        &lt;phase&gt;pre-integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;start-nodes&lt;/goal&gt;&lt;/goals&gt;
                    &lt;/execution&gt;
                    
                    &lt;!-- deploy fragment  --&gt;
                    &lt;execution&gt;
                        &lt;id&gt;deploy fragment&lt;/id&gt;
                        &lt;phase&gt;integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;deploy-fragment&lt;/goal&gt;&lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;fragmentType&gt;LIVEVIEW&lt;/fragmentType&gt;
                            &lt;target&gt;liveview&lt;/target&gt;
                            &lt;arguments&gt;
                                &lt;argument&gt;project=${project.basedir}/src/main/liveview&lt;/argument&gt;
                            &lt;/arguments&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;

                    &lt;!-- tests can be added  --&gt;

                    &lt;!-- stop nodes --&gt;
                    &lt;execution&gt;
                        &lt;id&gt;stop nodes&lt;/id&gt;
                        &lt;phase&gt;post-integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;stop-nodes&lt;/goal&gt;&lt;/goals&gt;
                    &lt;/execution&gt;
                    
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                
                    &lt;!-- wait for liveview to be started  --&gt;
                    &lt;execution&gt;
                        &lt;id&gt;wait for liveview&lt;/id&gt;
                        &lt;phase&gt;integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;run&lt;/goal&gt;&lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;target&gt;
                                &lt;!-- wait for max 5 minutes checking every 500ms --&gt;
                                &lt;waitfor maxwait=&quot;5&quot; maxwaitunit=&quot;minute&quot; checkevery=&quot;500&quot;&gt;
                                    &lt;resourcecontains resource=&quot;${project.build.directory}/test-nodes/A.${project.artifactId}/liveview0.out&quot; substring=&quot;LiveView is ready to accept client connections&quot;/&gt;
                                &lt;/waitfor&gt;
                            &lt;/target&gt;
                            &lt;skip&gt;${skipTests}&lt;/skip&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                    
                &lt;/executions&gt;
            &lt;/plugin&gt;

        &lt;/plugins&gt;

    &lt;/build&gt;
</pre></div></div>
</section><section>
<h2><a name="Add_LiveView_Web_war_file"></a>Add LiveView Web war file</h2>
<p>The LiveView Web war file is a maven dependency and can be added to a project thus :</p>

<div>
<div>
<pre class="source">...
    &lt;!-- common definitions for this version of StreamBase --&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.tibco.ep.sb.parent&lt;/groupId&gt;
        &lt;artifactId&gt;ep-liveview-fragment&lt;/artifactId&gt;
        &lt;version&gt;10.4.0&lt;/version&gt;
        &lt;relativePath/&gt;
    &lt;/parent&gt;
...
    &lt;dependencies&gt;
        ...
        &lt;dependency&gt;
            &lt;groupId&gt;com.tibco.ep.lvweb&lt;/groupId&gt;
            &lt;artifactId&gt;lvweb&lt;/artifactId&gt;
            &lt;type&gt;war&lt;/type&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        ...
    &lt;/dependencies&gt;
...
</pre></div></div>

<p>The parent pom will copy this dependency to the build directory ready to be added to the fragment archive :</p>

<div>
<div>
<pre class="source">...
[INFO] --- maven-dependency-plugin:2.8:copy-dependencies (copy lvweb) @ hellolvweb ---
[INFO] Copying lvweb-1.2.0.war to /Users/plord/workspace/dtmexamples/liveview-fragments/hellolvweb/target/classes/lv-user-webapps/lvweb.war
...
</pre></div></div>

<p>The LiveView application startup continues with :</p>

<div>
<div>
<pre class="source">...
[INFO] [A.hellolvweb] 2017-03-08 13:06:31.457+0000 [JettyService] INFO  c.s.l.server.core.JettyService - LiveView Web service listening on non-SSL port 58731
...
[INFO] [A.hellolvweb] *** All tables have been loaded. LiveView is ready to accept client connections.  Total start time(ms): 137945 ***
...
</pre></div></div>

<p><img src="images/lvweb.png" alt="LV Web" /></p></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2018&#x2013;2021<a href="http://www.tibco.com">TIBCO Software Inc.</a>.
.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
